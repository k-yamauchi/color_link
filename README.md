# カラーリンク (ColorLink)

パズル対戦ゲーム「カラーリンク」のPythonとFlaskを使用したWebアプリケーション実装です。AIエージェント対応版。

## ゲーム概要

プレイヤーはランダムに生成される3色のシーケンスを予想し、少ない手数でゴールを目指すパズルゲームです。

## ルール

- 5×5のグリッドボードを使用します
- 各セルは「赤・青・黄・緑・紫」の5色のいずれかで表示されます
- ゲーム開始時に、ランダムに3色のシーケンス（垂直方向の順序）が生成されます
- プレイヤーは色を選び、グリッドの任意の列に「差し込み」を行います
- 差し込みを行うと、列全体が下へシフトし、下端のセルは消え、上端に選んだ色が挿入されます
- 各列の上から3マスの縦並びと目標シーケンスを比較し、結果を判定します
- 各マスごとに色と位置が一致すると「HIT」、色だけが一致すると「BLOW」としてカウントします
- 1つの列で3HIT（全ての位置で色が一致）を達成すると勝利、制限ターン数に達すると敗北です
- シーケンスの長さが変わる場合（例：4色）、勝利条件も同じ数のHIT（4HIT）になります

## AIエージェント機能

この実装では3種類のAIエージェントが利用可能です：

1. **ルールベースAI**
   - ヒューリスティックに基づいた決定的なAI
   - 過去の行動結果（HIT/BLOW）から次の行動を決定
   - 列の多様性分析などの戦略を活用

2. **強化学習AI**
   - Q学習アルゴリズムを用いた学習型AI
   - プレイ経験から徐々に戦略を改善
   - ローカルにQ値テーブルを保存/読み込み

3. **ハイブリッドAI**
   - ルールベースと強化学習を組み合わせたAI
   - ゲームの進行状況に応じて戦略を動的に切り替え
   - シーケンス候補数などに基づいた適応的手法

### AI設定オプション

- AIの有効/無効切り替え
- AIタイプの選択（ルールベース/強化学習/ハイブリッド）
- 行動間隔の調整（0.5秒～3秒）
- 学習モードの切り替え（強化学習AIとハイブリッドAIのみ）
- デバッグモード（正解シーケンスの表示）

## トレーニングモード

- 強化学習AIとハイブリッドAIのトレーニング機能
- バックグラウンドトレーニングによるQ値テーブルの学習
- リアルタイムの学習状況モニタリング

## 開発環境

- Python 3.11+
- Flask（Webフレームワーク）
- JavaScript（クライアントサイド）

## インストール方法

```bash
# 依存パッケージのインストール（必要に応じて仮想環境を作成）
pip install -r requirements.txt # もしrequirements.txtがある場合
# または Poetry を使用
poetry install

# アプリケーションの起動
python -m color_link.app
```

## テスト実行方法

本プロジェクトはPytestを使用したテストスイートを含んでいます。テストを実行するには以下のコマンドを使用します：

```bash
# Poetryを使用する場合
poetry run pytest

# 詳細な出力を得る場合
poetry run pytest -v

# 特定のテストファイルのみ実行する場合
poetry run pytest tests/test_color_link_game.py

# カバレッジレポートを生成する場合（pytest-covのインストールが必要）
poetry run pytest --cov=color_link
```

テストは以下の3つのカテゴリに分かれています：

1. ゲームロジックテスト（`tests/test_color_link_game.py`）
2. ルールベースエージェントテスト（`tests/test_rule_based_agent.py`）
3. Flaskアプリケーションテスト（`tests/test_app.py`）

## 今後の拡張予定

- さらに高度な強化学習アルゴリズムの導入（DQNなど）
- AIの思考過程可視化機能の強化
- モバイル対応の改善
- マルチプレイヤーモードの追加 